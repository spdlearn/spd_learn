<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        #plot { width: 100%; height: 100%; }
    </style>
</head>
<body>
    <div id="plot"></div>
    <script>
        // Create mesh for the cone boundary (det = 0)
        // For 2x2 SPD matrix [[a,b],[b,c]], boundary is b² = ac
        const n = 40;

        // Parametric surface: use (a, c) as parameters, b = ±sqrt(ac) on boundary
        const aVals = [], cVals = [];
        for (let i = 0; i < n; i++) {
            aVals.push(0.01 + (3.0 * i / (n - 1)));
            cVals.push(0.01 + (3.0 * i / (n - 1)));
        }

        // Upper boundary surface (b = +sqrt(ac))
        const xUpper = [], yUpper = [], zUpper = [];
        for (let i = 0; i < n; i++) {
            const xRow = [], yRow = [], zRow = [];
            for (let j = 0; j < n; j++) {
                const a = aVals[i];
                const c = cVals[j];
                xRow.push(a);
                yRow.push(Math.sqrt(a * c));
                zRow.push(c);
            }
            xUpper.push(xRow);
            yUpper.push(yRow);
            zUpper.push(zRow);
        }

        // Lower boundary surface (b = -sqrt(ac))
        const xLower = [], yLower = [], zLower = [];
        for (let i = 0; i < n; i++) {
            const xRow = [], yRow = [], zRow = [];
            for (let j = 0; j < n; j++) {
                const a = aVals[i];
                const c = cVals[j];
                xRow.push(a);
                yRow.push(-Math.sqrt(a * c));
                zRow.push(c);
            }
            xLower.push(xRow);
            yLower.push(yRow);
            zLower.push(zRow);
        }

        // Generate random SPD points INSIDE the cone (det > 0, so |b| < sqrt(ac))
        // Using mulberry32 PRNG for reproducibility
        function mulberry32(a) {
            return function() {
                var t = a += 0x6D2B79F5;
                t = Math.imul(t ^ t >>> 15, t | 1);
                t ^= t + Math.imul(t ^ t >>> 7, t | 61);
                return ((t ^ t >>> 14) >>> 0) / 4294967296;
            }
        }

        const rand = mulberry32(42);
        const spdX = [], spdY = [], spdZ = [];
        for (let i = 0; i < 80; i++) {
            const a = 0.3 + rand() * 2.4;
            const c = 0.3 + rand() * 2.4;
            const bMax = Math.sqrt(a * c) * 0.85;  // Stay well inside cone
            const b = (rand() * 2 - 1) * bMax;
            spdX.push(a);
            spdY.push(b);
            spdZ.push(c);
        }

        const surfaceUpper = {
            type: 'surface',
            x: xUpper,
            y: yUpper,
            z: zUpper,
            opacity: 0.35,
            colorscale: [[0, 'rgb(79, 140, 255)'], [1, 'rgb(79, 140, 255)']],
            showscale: false,
            name: 'Cone boundary (det=0)',
            hoverinfo: 'skip'
        };

        const surfaceLower = {
            type: 'surface',
            x: xLower,
            y: yLower,
            z: zLower,
            opacity: 0.35,
            colorscale: [[0, 'rgb(79, 140, 255)'], [1, 'rgb(79, 140, 255)']],
            showscale: false,
            name: 'Cone boundary',
            hoverinfo: 'skip',
            showlegend: false
        };

        const spdPoints = {
            type: 'scatter3d',
            mode: 'markers',
            x: spdX,
            y: spdY,
            z: spdZ,
            marker: {
                size: 4,
                color: 'rgb(238, 76, 44)',
                opacity: 0.9
            },
            name: 'SPD matrices (det > 0)',
            hovertemplate: 'a=%{x:.2f}<br>b=%{y:.2f}<br>c=%{z:.2f}<br>det=%{customdata:.2f}<extra></extra>',
            customdata: spdX.map((a, i) => a * spdZ[i] - spdY[i] * spdY[i])
        };

        const layout = {
            title: {
                text: '<b>SPD Manifold as a Cone in 3D</b><br><span style="font-size:13px;color:#666">2×2 symmetric matrices: SPD region is inside the cone (det > 0)</span>',
                font: { size: 18 }
            },
            scene: {
                xaxis: { title: 'a (diagonal)', range: [0, 3.2] },
                yaxis: { title: 'b (off-diagonal)', range: [-3, 3] },
                zaxis: { title: 'c (diagonal)', range: [0, 3.2] },
                camera: {
                    eye: { x: 1.8, y: 1.4, z: 1.0 }
                },
                aspectmode: 'cube'
            },
            margin: { l: 10, r: 10, t: 60, b: 10 },
            legend: {
                x: 0.01,
                y: 0.99,
                bgcolor: 'rgba(255,255,255,0.85)',
                bordercolor: 'rgba(0,0,0,0.1)',
                borderwidth: 1
            },
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)'
        };

        Plotly.newPlot('plot', [surfaceUpper, surfaceLower, spdPoints], layout, {responsive: true});
    </script>
</body>
</html>
